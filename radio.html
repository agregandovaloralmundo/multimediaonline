<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Radio en Vivo - Escucha Emisoras Internacionales | Multimedia Online</title>

	<!-- Metadatos SEO -->
	<meta name="description" content="Escucha emisoras de radio en l√≠nea de todo el mundo. Transmisi√≥n gratuita, sin registros. Calidad de sonido y variedad de g√©neros.">
	<meta name="keywords" content="
	  radio en l√≠nea, emisoras en vivo, radio online gratis, emisoras internacionales, escuchar radio por internet,
	  radio sin interrupciones, emisoras culturales, estaciones en espa√±ol, radio mundial, transmisi√≥n de radio educativa,
	  radio m√∫sica cl√°sica, radio noticias, radio rock, radio jazz, estaciones informativas, emisoras digitales, 
	  escuchar radio online sin costo, streaming de radio en espa√±ol, emisoras gratuitas para estudiantes
	">
	<meta name="author" content="Lic. Antonio Ram√≠rez Bogantes">

	<!-- Metadatos sociales (Open Graph) -->
	<meta property="og:title" content="Escucha Radio en Vivo - Plataforma Multimedia Online">
	<meta property="og:description" content="Explora emisoras de radio en vivo desde diferentes pa√≠ses. Sin registro, sin interrupciones.">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://agregandovaloralmundo.github.io/multimediaonline/radio.html">
	<meta property="og:image" content="https://agregandovaloralmundo.github.io/multimediaonline/img/preview.jpg">

	<!-- Metadatos para Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Escucha Radio en Vivo - Multimedia Online">
	<meta name="twitter:description" content="Transmisi√≥n gratuita de emisoras internacionales. Solo haz clic y disfruta.">
	<meta name="twitter:image" content="https://agregandovaloralmundo.github.io/multimediaonline/img/preview.jpg">

	<!-- JSON-LD -->
	<script type="application/ld+json">
	{
	  "@context": "https://schema.org",
	  "@type": "WebPage",
	  "name": "Radio en Vivo - Multimedia Online",
	  "url": "https://agregandovaloralmundo.github.io/multimediaonline/radio.html",
	  "description": "Escucha emisoras de radio en l√≠nea de todo el mundo sin costo, sin interrupciones y con excelente calidad.",
	  "author": {
		"@type": "Person",
		"name": "Lic. Antonio Ram√≠rez Bogantes"
	  },
	  "creator": {
		"@type": "Person",
		"name": "Ing. Nicole Ram√≠rez Ulate",
		"jobTitle": "L√≠der de desarrollo e ingenier√≠a inform√°tica"
	  }
	}
	</script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìª</text></svg>">



  <style>
    /* --- Estilos Base y Grid --- */
    html, body { height: 100%; margin: 0; }
    .main-wrapper { display: flex; flex-direction: column; min-height: 100vh; }
    main { flex: 1; }
    .radio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin: 1rem 0; }
    .station-button { padding: 1rem; background-color: #e7f5ff; color: #003366; border: 1px solid #cce5ff; border-radius: 10px; text-align: center; transition: background-color 0.3s; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 110px; }
    .station-button.active:not(.blinking) { background-color: #b8daff; border-color: #80bdff; font-weight: bold; }
    .station-button:hover { background-color: #cfe2ff; }

    /* Contenedor para imagen y GIF */
    .image-container { display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem; min-height: 60px; /* Altura fija para logo */ }
    .station-button img.station-logo { max-width: 65%; /* Reducido para dejar espacio claro al GIF */ height: 60px; object-fit: contain; }

    /* Estilo para el GIF de estado */
    .status-gif {
        /* MODIFICADO: Tama√±o aumentado */
        width: 90px;
        height: 90px;
        margin-right: 0.6em; /* Aumentado espacio */
        display: none; /* Oculto por defecto */
        vertical-align: middle;
        flex-shrink: 0; /* Evita que se encoja */
    }
    .station-button.blinking .status-gif {
        display: inline-block; /* Mostrar solo cuando parpadea */
    }

    /* Estilos Visualizer Grande */
    #visualizer { display: block; width: 100%; margin: 1.5rem 0 0.5rem 0; height: 80px; background-color: #e7f5ff; border-radius: 5px; }

    /* Estilos Contenedor Player Oculto */
    .audio-player-container { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; margin: 0.5rem 0; }
    #radio-player { display: none; }
    #now-playing { display: none; }

    /* Ajustes responsivos */
    @media (max-width: 575px) {
         #visualizer { margin: 1rem 0 0.5rem 0; height: 60px; }
         .radio-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; }
         .status-gif { width: 25px; height: 25px; margin-right: 0.4em;} /* GIF m√°s peque√±o en m√≥vil */
         .station-button img.station-logo { max-width: 80%; } /* Ajustar logo en m√≥vil */
    }

    /* Animaci√≥n de parpadeo */
    @keyframes parpadeoBoton { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .station-button.blinking { animation: parpadeoBoton 1.2s infinite; background-color: #b8daff; border-color: #80bdff; font-weight: bold; }

	.icons-container {
	  font-size: 2rem;
	  margin-top: 0.5rem;
	}


  </style>
</head>
<body>
<div class="main-wrapper">

  <!-- NAVBAR -->
  <div id="navbar-placeholder"></div>
  <script src="navbar.js"></script>

  <!-- main -->
  <main class="container-fluid text-center mt-4 mb-2 flex-grow-1">
  
	  <div class="d-flex justify-content-center align-items-center flex-wrap gap-3 mb-3">
	  <h2 class="mb-0">Radio en Vivo</h2>
	  <div class="icons-container">
		<span id="icon-play" style="display: none; font-size: 2rem; cursor: pointer;">‚ñ∂</span>
		<span id="icon-stop" style="display: none; font-size: 2rem; cursor: pointer;">‚ñ†</span>
		<span id="icon-loading" style="display: none; font-size: 2rem;">‚è≥</span>
	  </div>
	</div>
	<p class="text-muted">Haz clic sobre una emisora para comenzar a escuchar</p>

    <div id="station-container" class="radio-grid px-md-3">
      <!-- Las emisoras ser√°n insertadas por JavaScript -->
    </div>

    <!-- Canvas para Visualizer Grande -->
    <canvas id="visualizer"></canvas>
	
    <!-- Contenedor para elementos ocultos (player y texto) -->
    <div class="audio-player-container">
        <audio id="radio-player" crossorigin="anonymous"></audio>
        <div id="now-playing" class="text-muted fw-bold">üéµ Selecciona una emisora</div>
    </div>

  </main>

  <!-- FOOTER -->
  <div id="footer-placeholder"></div>
  <script src="footer.js"></script>

</div> <!-- Fin .main-wrapper -->

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- L√≥gica de Estaciones y Botones ---
    const defaultLogo = "img/hombreradio.png";
    const stations = [ /* ... Tu lista de estaciones ... */
          { name: "Radio 1 Test", logo: "img/hombreradio.png", stream: "http://icecast.omroep.nl/radio1-bb-mp3" },
          { name: "Blu Radio Colombia", logo: "img/hombreradio.png", stream: "https://playerservices.streamtheworld.com/api/livestream-redirect/BLURADIO_SC" },
          { name: "Cadena SER Espa√±a", logo: "img/hombreradio.png", stream: "https://playerservices.streamtheworld.com/api/livestream-redirect/CADENASER_SC" },
          { name: "NPR USA", logo: "img/hombreradio.png", stream: "https://npr-ice.streamguys1.com/live.mp3" },
          { name: "KEXP Seattle", logo: "img/hombreradio.png", stream: "https://kexp-mp3-128.streamguys1.com/kexp128.mp3" },
          { name: "WNYC New York", logo: "img/hombreradio.png", stream: "https://fm939.wnyc.org/wnycfm-web" },
          { name: "WQXR New York", logo: "img/hombreradio.png", stream: "https://stream.wqxr.org/wqxr" },
          { name: "The Current MN", logo: "img/hombreradio.png", stream: "https://current.stream.publicradio.org/kcmp.mp3" },
          { name: "BBC World Service", logo: "img/hombreradio.png", stream: "https://stream.live.vc.bbcmedia.co.uk/bbc_world_service" },
          { name: "Radio Cooperativa Chile", logo: "img/hombreradio.png", stream: "https://unlimited11-cl.dps.live/cooperativafm/aac/icecast.audio" },
          { name: "RFI en Espa√±ol", logo: "img/hombreradio.png", stream: "https://rfienespagnol64k.ice.infomaniak.ch/rfienespagnol-64.mp3" },
          { name: "La Mejor FM M√©xico", logo: "img/hombreradio.png", stream: "https://playerservices.streamtheworld.com/api/livestream-redirect/XEQR_FM_SC" },
          { name: "Radio Rivadavia", logo: "img/hombreradio.png", stream: "https://27443.live.streamtheworld.com/RIVADAVIA_SC" },
          { name: "Aspen FM", logo: "img/hombreradio.png", stream: "https://playerservices.streamtheworld.com/api/livestream-redirect/ASPEN_SC" },
          { name: "Ethereal Eighties", logo: "img/hombreradio.png", stream: "https://us1.internet-radio.com/proxy/etherealeighties?mp=/live" },
          { name: "Belters Radio", logo: "img/hombreradio.png", stream: "https://uk2.internet-radio.com/proxy/belters?mp=/live" },
          { name: "The Hitman Radio", logo: "img/hombreradio.png", stream: "https://uk2.internet-radio.com/proxy/thehitmanradio?mp=/stream" },
          { name: "Radio Monster Evergreens", logo: "img/hombreradio.png", stream: "https://ic.radiomonster.fm/evergreens.ultra" },
          { name: "Simon Yates Radio", logo: "img/hombreradio.png", stream: "https://uk7.internet-radio.com/proxy/simonyates44?mp=/stream;" },
          { name: "Joy Radio", logo: "img/hombreradio.png", stream: "https://uk5.internet-radio.com/proxy/joyradio?mp=/stream" },
          { name: "Box Radio UK", logo: "img/hombreradio.png", stream: "https://uk7.internet-radio.com/proxy/boxradiouk?mp=/live" },
          { name: "80s Soundtracks", logo: "img/hombreradio.png", stream: "https://uk5.internet-radio.com/proxy/80ssoundtracks?mp=/stream" },
          { name: "IP Stream 178.33", logo: "img/hombreradio.png", stream: "http://178.33.135.244:2802/stream/1/" },
          { name: "IP Stream 91.232", logo: "img/hombreradio.png", stream: "http://91.232.4.33:8018/stream/1/" },
          { name: "IP Stream 176.31", logo: "img/hombreradio.png", stream: "http://176.31.248.14:35508/stream/1/" },
          { name: "IP Stream 79.143", logo: "img/hombreradio.png", stream: "http://79.143.187.96:8000/stream/1/" },
          { name: "Prostream365 Live", logo: "img/hombreradio.png", stream: "https://c2.prostream365.com:8000/live" },
          { name: "IP Stream 178.159", logo: "img/hombreradio.png", stream: "http://178.159.3.22:18004/stream/1/" },
    ];

    // Pre-cargar logos
    stations.forEach(station => { const img = new Image(); img.src = station.logo; img.onerror = () => station.logo = defaultLogo; });

    const stationContainer = document.getElementById("station-container");
    const player = document.getElementById("radio-player"); // Referencia al player oculto
    const nowPlaying = document.getElementById("now-playing"); // Referencia al texto oculto
	
	const iconPlay = document.getElementById("icon-play");
	const iconStop = document.getElementById("icon-stop");
	const iconLoading = document.getElementById("icon-loading");
	
	// Alternar reproducir o detener al hacer clic en el √≠cono ‚ñ∂
	iconPlay.addEventListener("click", () => {
    if (player && !player.paused) {
        player.pause();
        player.src = "";
        nowPlaying.textContent = "‚èπÔ∏è Emisora detenida";

        iconPlay.style.display = "none";
        iconStop.style.display = "none";
        iconLoading.style.display = "none";

        // Detener visualizador
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
        if (visualizerCtx && visualizerCanvas) {
            visualizerCtx.fillStyle = '#e7f5ff';
            visualizerCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
        }

        document.querySelectorAll(".station-button").forEach(el => {
            el.classList.remove("blinking");
            const gif = el.querySelector('.status-gif');
            if (gif) gif.style.display = 'none';
        });
    }
	});

    // Variables del Visualizador
    const visualizerCanvas = document.getElementById('visualizer');
    const visualizerCtx = visualizerCanvas ? visualizerCanvas.getContext('2d') : null;
    let audioCtx;
    let analyser;
    let source;
    let animationFrameId = null; // Para controlar el bucle de animaci√≥n

    // Crear botones
    stations.forEach(station => {
        const btn = document.createElement("div");
        btn.className = "station-button";
        // HTML con image-container y GIF
        btn.innerHTML = `
            <div class="image-container">
                <img src="img/ruedadentada.gif" class="status-gif" alt="Reproduciendo">
                <img src="${station.logo}" class="station-logo" alt="${station.name}" onerror="this.onerror=null;this.src='${defaultLogo}';">
            </div>
            <div>${station.name}</div>
        `;
        const statusGif = btn.querySelector('.status-gif'); // Guardar referencia al GIF

        btn.addEventListener("click", () => {
            console.log(`Clic en: ${station.name}`); // Log para depurar
            if (player) {
                // Detener animaci√≥n anterior si la hubiera
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                    console.log("Animaci√≥n visualizador anterior cancelada.");
                     // Limpiar canvas al detener
                    if (visualizerCtx && visualizerCanvas){
                        visualizerCtx.fillStyle = '#e7f5ff';
                        visualizerCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
                    }
                }
				
				iconPlay.style.display = "none";
				iconStop.style.display = "none";
				iconLoading.style.display = "inline-block";


                player.src = station.stream;
                player.load(); // Buena pr√°ctica antes de play
                player.play().then(() => {
                    console.log(`Reproduciendo: ${station.name}`); // Log
                    nowPlaying.textContent = `üéµ Reproduciendo: ${station.name}`; // Actualiza aunque oculto
					
					iconLoading.style.display = "none";
					iconPlay.style.display = "inline-block";


                    // Control visual de botones y GIF
                    document.querySelectorAll(".station-button").forEach(el => {
                        el.classList.remove("active");
                        el.classList.remove("blinking");
                        const gif = el.querySelector('.status-gif');
                        if (gif) gif.style.display = 'none';
                    });
                    btn.classList.add("blinking");
                    if (statusGif) statusGif.style.display = 'inline-block';

                    // Iniciar/Reanudar Visualizador
                    console.log("Intentando iniciar/reanudar visualizador..."); // Log
                    try {
                        if (!audioCtx || audioCtx.state === 'closed') {
                            console.log("AudioContext no existe o cerrado, llamando a initVisualizer..."); // Log
                            initVisualizer();
                        } else if (audioCtx.state === "suspended") {
                            console.log("AudioContext suspendido, reanudando..."); // Log
                            audioCtx.resume().then(() => {
                                console.log("AudioContext reanudado."); // Log
                                // Asegurar que la animaci√≥n reinicie si estaba detenida
                                if (!animationFrameId && analyser) {
                                     const bufferLength = analyser.frequencyBinCount;
                                     const dataArray = new Uint8Array(bufferLength);
                                     drawVisualizer(dataArray, bufferLength);
                                }
                            }).catch(e=>console.error("Resume error", e));
                        } else {
                             console.log("AudioContext ya corriendo."); // Log
                             // Si ya estaba corriendo, asegurar que la animaci√≥n est√© activa
                             if (!animationFrameId && analyser) {
                                 const bufferLength = analyser.frequencyBinCount;
                                 const dataArray = new Uint8Array(bufferLength);
                                 drawVisualizer(dataArray, bufferLength);
                             }
                        }
                        // Redimensionar canvas por si acaso
                        if (visualizerCtx && visualizerCanvas.isConnected) {
                             visualizerCanvas.width = visualizerCanvas.clientWidth;
                             visualizerCanvas.height = visualizerCanvas.clientHeight;
                         }
                    } catch (e) { console.error("Error visualizer init/resume", e); }

                }).catch(error => {
                     console.error(`Error al reproducir ${station.name}:`, error);
                     nowPlaying.textContent = `‚ùå Error: ${station.name}`;
					 
					 iconLoading.style.display = "none";
					 iconStop.style.display = "inline-block";

					 
                     document.querySelectorAll(".station-button").forEach(el => {
                         el.classList.remove("active");
                         el.classList.remove("blinking");
                         const gif = el.querySelector('.status-gif');
                         if (gif) gif.style.display = 'none';
                     });
                     // Detener animaci√≥n y limpiar si hay error
                     if (animationFrameId) { cancelAnimationFrame(animationFrameId); animationFrameId = null; }
                     if (visualizerCtx && visualizerCanvas){ visualizerCtx.fillStyle = '#e7f5ff'; visualizerCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height); }
                });
            } else { console.error("Elemento <audio> #radio-player no encontrado."); }
        });
        stationContainer.appendChild(btn);
    });

    // --- Funciones del Visualizer (Revisadas con Log y control de animaci√≥n) ---
    function initVisualizer() {
        console.log("Entrando a initVisualizer"); // Log
        if (!visualizerCanvas || !visualizerCtx) { console.error("Canvas o Ctx no disponible"); return; }
        if (!player) { console.error("Visualizer no puede iniciar: <audio> no encontrado."); return; }

        if (!audioCtx || audioCtx.state === 'closed') {
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                console.log("Nuevo AudioContext creado."); // Log
            }
            catch (e) { console.error("Error creando AudioContext:", e); return; }
        }

        // Crear Analyser siempre
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        console.log("Analyser creado."); // Log

        // (Re)Conectar la fuente
        if (source && source.context === audioCtx) { try { source.disconnect(); console.log("Source anterior desconectado.");} catch(e) {} }
        try {
            source = audioCtx.createMediaElementSource(player);
            source.connect(analyser);
            analyser.connect(audioCtx.destination);
            console.log("Source conectado a analyser y destination."); // Log
        } catch (e) { console.error("Error conectando source:", e); return; }

        // Ajustar tama√±o canvas
        try {
            visualizerCanvas.width = visualizerCanvas.clientWidth;
            visualizerCanvas.height = visualizerCanvas.clientHeight;
        } catch(e){}

        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        console.log("Iniciando bucle drawVisualizer..."); // Log

        // Iniciar el bucle de dibujo
        if (animationFrameId) cancelAnimationFrame(animationFrameId); // Cancela anterior si existe
        drawVisualizer(dataArray, bufferLength);
    }

    function drawVisualizer(dataArray, bufferLength) {
        // Solicitar siguiente cuadro ANTES de verificar, para mantener el bucle
        animationFrameId = requestAnimationFrame(() => drawVisualizer(dataArray, bufferLength));

        // Verificar estado ANTES de dibujar
        if (!visualizerCtx || !analyser || !audioCtx || audioCtx.state !== 'running') { // Asegurarse que est√© 'running'
             // No dibujar si el contexto no est√° listo o est√° suspendido/cerrado
             // Podr√≠amos limpiar el canvas aqu√≠ si lo deseamos al detenerse
            // console.log("Visualizer draw detenido (estado no running o Ctx/Analyser inv√°lido)");
            // Limpiar canvas si se detiene
            if (visualizerCtx && visualizerCanvas){ visualizerCtx.fillStyle = '#e7f5ff'; visualizerCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height); }
            cancelAnimationFrame(animationFrameId); // Detener el bucle expl√≠citamente
            animationFrameId = null;
            return;
        }

        // Obtener datos y dibujar
        try {
            analyser.getByteFrequencyData(dataArray);
            visualizerCtx.fillStyle = '#e7f5ff'; // Limpiar
            visualizerCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);

            const barGap = 1;
            const segmentWidth = visualizerCanvas.width / bufferLength;
            let barWidth = Math.max(1, segmentWidth - barGap);
            visualizerCtx.fillStyle = "#007bff"; // Color barras

            for (let i = 0; i < bufferLength; i++) {
                const x = i * segmentWidth;
                const barHeight = (dataArray[i] / 255) * visualizerCanvas.height;
                let currentBarWidth = barWidth;
                if (i === bufferLength - 1) { currentBarWidth = Math.max(1, visualizerCanvas.width - x); }
                visualizerCtx.fillRect(x, visualizerCanvas.height - barHeight, currentBarWidth, barHeight);
            }
        } catch(e) {
            console.error("Error dibujando visualizer:", e);
            cancelAnimationFrame(animationFrameId); // Detener si hay error
            animationFrameId = null;
        }
    }

    // Listener de resize (sin cambios)
    window.addEventListener('resize', () => { /* ... (sin cambios) ... */ });
	
	// ‚úÖ Peg√° aqu√≠ este nuevo bloque para habilitar el bot√≥n detener:
	iconStop.addEventListener("click", () => {
    if (!player.paused) {
        player.pause();
        player.src = "";
        nowPlaying.textContent = "‚èπÔ∏è Emisora detenida";

        // Ocultar √≠conos
        iconPlay.style.display = "none";
        iconStop.style.display = "none";
        iconLoading.style.display = "none";

        // Limpiar visualizador
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
        if (visualizerCtx && visualizerCanvas) {
            visualizerCtx.fillStyle = '#e7f5ff';
            visualizerCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
        }

        // Remover estado visual de botones
        document.querySelectorAll(".station-button").forEach(el => {
            el.classList.remove("blinking");
            const gif = el.querySelector('.status-gif');
            if (gif) gif.style.display = 'none';
        });
    }
});
</script>

</script>

</body>
</html>